<!doctype html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FPXS9SZL3W"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-FPXS9SZL3W');
  </script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark light" />
  <title>Wellness Warriors ‚Äì Race Events</title>
  <meta name="description" content="Upcoming races the Wellness Warriors are running: dates, distances, locations, and race leaders." />
  <link rel="stylesheet" href="style.css" />
  <style>
    .runners-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }
    .runner-tag {
        display: inline-block;
        padding: 8px 16px;                 /* ‚¨Ö BIGGER padding (key change) */
        background: rgba(249, 115, 22, 0.14);
        border: 2px solid rgba(249, 115, 22, 0.55);
        border-radius: 999px;              /* ‚¨Ö true pill shape */
        font-size: 13px;
        line-height: 1;                    /* ‚¨Ö prevents vertical squish */
        color: var(--text, #333);
      }

    .runner-count {
      font-weight: 600;
      color: rgba(249, 115, 22, 1);
    }

    /* --- Signup UI --- */
    .signup {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }
    .signup input[type="text"]{
      width: min(260px, 100%);
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color: var(--text, #333);
      outline: none;
    }
    .signup input[type="text"]::placeholder{
      color: var(--text-muted, #888);
    }
    .signup .btn-inline{
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(249, 115, 22, 0.18);
      cursor: pointer;
      font-weight: 600;
      color: var(--text, #333);
      white-space: nowrap;
    }
    .signup .btn-inline[disabled]{
      opacity: .65;
      cursor: not-allowed;
    }
    .signup .msg{
      font-size: 12px;
      color: var(--text-muted, #888);
      min-height: 16px;
    }

    /* --- Responsive race list --- */
#tableContainer { overflow: visible; } /* we‚Äôll control overflow on desktop only */

.race-cards { display: none; margin-top: 14px; }
.race-card {
  padding: 14px;
  border-radius: 18px;
}
.race-title a { text-decoration: none; }
.race-meta {
  display: grid;
  grid-template-columns: 1fr;
  gap: 10px;
  margin-top: 10px;
  color: var(--text, #333);
}
.race-pillrow { display: flex; flex-wrap: wrap; gap: 8px; }
.race-pill {
  padding: 8px 10px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.16);
  background: rgba(255,255,255,.06);
  font-size: 13px;
}
.race-label { color: var(--text-muted, #888); font-size: 12px; margin-bottom: 4px; }
.race-value { font-weight: 600; }

@media (min-width: 860px) {
  /* Desktop/table view */
  #tableContainer { overflow: auto; }
  .race-cards { display: none; }
}

@media (max-width: 859px) {
  /* Mobile/card view */
  #tableContainer { display: none !important; }
  .race-cards { display: grid; gap: 12px; }
  table.table thead { display: none; } /* just in case */
}

.race-cards { display: none; gap: 12px; margin-top: 14px; }

@media (max-width: 859px) {
  #tableContainer { display: none !important; }
  .race-cards { display: grid !important; }
}

@media (min-width: 860px) {
  #tableContainer { display: block !important; }
  .race-cards { display: none !important; }
}

  </style>
</head>

<body>
  <!-- Ambient background -->
  <div class="bg-ambient" aria-hidden="true">
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="grid"></div>
    <div class="noise"></div>
  </div>

  <!-- Mobile drawer -->
  <div class="drawer-backdrop" id="drawerBackdrop" hidden></div>
  <aside class="drawer" id="drawer" aria-hidden="true">
    <div class="drawer-top">
      <div class="brand-mini">
        <img src="logo.jpeg" alt="Wellness Warriors logo" onerror="this.style.display='none'">
        <div>
          <div class="brand-kicker">Running Group</div>
          <div class="brand-name">Wellness Warriors</div>
        </div>
      </div>
      <button class="icon-btn" id="drawerClose" aria-label="Close menu">
        <span class="icon-x"></span>
      </button>
    </div>

    <nav class="drawer-nav" aria-label="Mobile">
      <a href="index.html#about" data-close>About</a>
      <a href="index.html#guidelines" data-close>Guidelines</a>
      <a href="index.html#schedule" data-close>Schedule</a>
      <a href="index.html#events" data-close>Events</a>
      <a href="index.html#photos" data-close>Photos</a>
      <a href="index.html#contact" data-close>Contact</a>
    </nav>

    <div class="drawer-cta">
      <a class="btn btn-primary" href="https://strava.com/clubs/wellness-warriors" target="_blank" rel="noreferrer">
        Join on Strava <span class="arrow">‚Üí</span>
      </a>
      <a class="btn btn-ghost" href="https://facebook.com/groups/wellnesswarriors" target="_blank" rel="noreferrer">
        Facebook Group <span class="arrow">‚Üó</span>
      </a>
    </div>
  </aside>

  <!-- Top bar -->
  <header class="topbar">
    <div class="container topbar-inner">
      <a class="brand" href="index.html#top" aria-label="Wellness Warriors home">
        <img src="logo.jpeg" alt="Wellness Warriors logo" class="brand-logo" onerror="this.style.display='none'">
        <div class="brand-text">
          <div class="brand-kicker">Running Group</div>
          <div class="brand-name">Wellness Warriors</div>
        </div>
      </a>

      <nav class="nav" aria-label="Primary">
        <a href="index.html#about">About</a>
        <a href="index.html#guidelines">Guidelines</a>
        <a href="index.html#schedule">Schedule</a>
        <a href="index.html#training">Training</a>
        <a href="running-tips.html">Running Tips</a>
        <a href="events.html" class="active">Events</a>
        <a href="index.html#photos">Photos</a>
      </nav>
  
      <div class="topbar-actions">
        <a class="pill" href="https://strava.com/clubs/wellness-warriors" target="_blank" rel="noreferrer" title="Strava">
          <span class="dot"></span> Strava
        </a>
        <a class="pill" href="https://facebook.com/groups/wellnesswarriors" target="_blank" rel="noreferrer" title="Facebook">
          <span class="dot dot2"></span> Facebook
        </a>
        <button class="icon-btn burger" id="drawerOpen" aria-label="Open menu">
          <span class="icon-burger"><span></span></span>
        </button>
        <button class="icon-btn" id="themeToggle" aria-label="Toggle theme" title="Toggle theme">
          <span class="icon-sun"></span>
        </button>
      </div>
    </div>
  </header>

  <main id="top">
    <!-- Hero -->
    <section class="hero">
      <div class="hero-media" aria-hidden="true">
        <img
          class="hero-img"
          src="marathon-running-light-morning-people-260nw-2448695941.jpg?auto=format&fit=crop&w=2400&q=80"
          alt=""
          loading="eager"
        />
        <div class="hero-overlay"></div>
      </div>

      <div class="container hero-inner">
        <div class="hero-left reveal">
          <div class="chips">
            <span class="chip"><span class="chip-icon">üìÖ</span> Race calendar</span>
            <span class="chip"><span class="chip-icon">üèÉ</span> Half + Full</span>
            <span class="chip"><span class="chip-icon">ü§ù</span> Leader-led</span>
          </div>

          <h1 class="hero-title">
            Events & Races
          </h1>

          <p class="hero-subtitle">
            Here's what the team is running next. Each race has a Wellness Warriors race leader ‚Äì
            reach out to coordinate carpools, hotels, shakeouts, and meet-up spots.
          </p>

          <div class="hero-cta">
            <a class="btn btn-primary" href="#eventsTable">View races <span class="arrow">‚Üí</span></a>
            <a class="btn btn-ghost" href="index.html#contact">General questions <span class="arrow">‚Üó</span></a>
          </div>
        </div>

        <div class="hero-right reveal" style="--d: 120ms">
          <div class="glass card">
            <div class="card-top">
              <div>
                <div class="card-kicker">How it works</div>
                <div class="card-title">Race leader</div>
              </div>
            </div>

            <div class="guides" style="gap:12px">
              <div class="guide">
                <div class="g-ic">üß≠</div>
                <div>
                  <div class="g-title">Planning</div>
                  <div class="g-sub">Meetup spots, logistics, and course tips.</div>
                </div>
              </div>
              <div class="guide">
                <div class="g-ic">üì£</div>
                <div>
                  <div class="g-title">Communication</div>
                  <div class="g-sub">Group chat + pre-race reminders.</div>
                </div>
              </div>
              <div class="guide">
                <div class="g-ic">ü´∂</div>
                <div>
                  <div class="g-title">Support</div>
                  <div class="g-sub">Cheer squads and post-race hangs.</div>
                </div>
              </div>
            </div>

            <div class="card-actions">
              <a class="btn btn-soft" href="index.html#events">Back to homepage</a>
              <a class="btn btn-soft" href="#eventsTable">See races</a>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Events table -->
    <section id="eventsTable" class="section section-alt">
      <div class="container">
        <div class="section-head reveal">
          <div class="section-kicker">Race list</div>
          <h2>Upcoming races</h2>
          <p>
            Click a race name for the official website. Click a leader to email them.
          </p>
        </div>

        <div class="glass card reveal">
          <div class="card-top">
            <div>
              <div class="card-kicker" id="raceYear">2026</div>
              <div class="card-title">Wellness Warriors race calendar</div>
            </div>
            <span class="badge">Live</span>
          </div>

          <div id="loadingState" style="padding: 40px; text-align: center; color: var(--text-muted, #888);">
            Loading races...
          </div>

          <div id="errorState" style="padding: 40px; text-align: center; color: var(--text-muted, #888); display: none;">
            Unable to load races. Please try again later.
          </div>

          <div id="tableContainer" style="overflow:auto; display: none;">
            <table class="table" style="width:100%; border-collapse:separate; border-spacing:0 10px">
              <thead>
                <tr style="text-align:left">
                  <th style="padding:10px 12px">Race name</th>
                  <th style="padding:10px 12px">Distance</th>
                  <th style="padding:10px 12px">Date</th>
                  <th style="padding:10px 12px">Location</th>
                  <th style="padding:10px 12px">Race leader</th>
                  <th style="padding:10px 12px">Runners</th>
                </tr>
              </thead>
              <tbody id="racesTableBody">
                <!-- Races will be inserted here dynamically -->
              </tbody>
            </table>
          </div>
          <div id="cardsContainer" class="race-cards"></div>


          <div class="card-actions" style="margin-top:10px">
            <a class="btn btn-primary" href="index.html#contact">Volunteer as a race leader <span class="arrow">‚Üí</span></a>
            <a class="btn btn-ghost" href="index.html#events">Back to homepage <span class="arrow">‚Üó</span></a>
          </div>
        </div>

        <footer class="footer" style="margin-top:22px">
          <div class="footer-left">
            <img src="logo.jpeg" alt="Wellness Warriors logo" class="footer-logo" onerror="this.style.display='none'">
            <div>
              <div class="footer-name">Wellness Warriors</div>
              <div class="footer-tag">Run ‚Ä¢ Recover ‚Ä¢ Repeat</div>
            </div>
          </div>
          <div class="footer-right">
            <a href="https://strava.app.link/ikZjfp1b8Yb" target="_blank" rel="noreferrer">Strava</a>
            <a href="https://facebook.com/groups/wellnesswarriors" target="_blank" rel="noreferrer">Facebook</a>
            <span class="sep">¬∑</span>
            <span>¬© <span id="year"></span></span>
          </div>
        </footer>
      </div>
    </section>
  </main>

  <script src="script.js"></script>
  <script>
    // Load race data from JSON file
    async function loadRaces() {
      const loadingEl = document.getElementById('loadingState');
      const errorEl = document.getElementById('errorState');
      const tableEl = document.getElementById('tableContainer');
      const tbody = document.getElementById('racesTableBody');
      const cards = document.getElementById('cardsContainer');

      
      try {
        // Fetch the races data from JSON file
      //  const url = `https://raw.githubusercontent.com/wellnesswarriors/running-club/refs/heads/main/races.json?t=${Date.now()}`;
      //  const response = await fetch(url);

        const response = await fetch(
          'https://running-club-api.vercel.app/api/get-races',
          { cache: 'no-store' }
        );

        
        if (!response.ok) {
          throw new Error('Failed to load races');
        }
        
        const data = await response.json();
        
        // Update year if provided
        if (data.year) {
          document.getElementById('raceYear').textContent = data.year;
        }
        
        // Clear existing content
        tbody.innerHTML = '';
        cards.innerHTML = '';

        
        // Sort races by date
        const sortedRaces = data.races.sort((a, b) => new Date(a.date) - new Date(b.date));
        
        // Generate table rows
        sortedRaces.forEach(race => {
          const row = document.createElement('tr');
          row.className = 'glass';
          
          const emailSubject = encodeURIComponent(`${race.name} - Wellness Warriors Meetup`);
          const emailLink = `mailto:${race.leaderEmail || 'wellnesswarriorschicago@gmail.com'}?subject=${emailSubject}`;
          
          // Format runners list
          const runnersHTML = formatRunners(race.runners || []);
          const raceId = makeRaceId(race);
          const signupHTML = renderSignup(raceId);
          
          row.innerHTML = `
            <td style="padding:10px 12px">
              <strong>
                <a href="${race.url}" target="_blank" rel="noreferrer">
                  ${race.name}
                </a>
              </strong>
            </td>
            <td style="padding:10px 12px">${race.distance}</td>
            <td style="padding:10px 12px">${formatDate(race.date)}</td>
            <td style="padding:10px 12px">${race.location}</td>
            <td style="padding:10px 12px">${race.leader}</td>
            <td style="padding:10px 12px">
              ${runnersHTML}
              ${signupHTML}
            </td>
          `;
          
          tbody.appendChild(row);
          const card = document.createElement('div');
          card.className = 'glass race-card';

          card.innerHTML = `
            <div class="race-title">
              <div class="race-label">Race</div>
              <div class="race-value" style="font-size:16px; line-height:1.25;">
                <a href="${race.url}" target="_blank" rel="noreferrer">${race.name}</a>
              </div>
            </div>

            <div class="race-meta">
              <div class="race-pillrow">
                <span class="race-pill">üìè ${race.distance}</span>
                <span class="race-pill">üìÖ ${formatDate(race.date)}</span>
                <span class="race-pill">üìç ${race.location}</span>
              </div>

              <div>
                <div class="race-label">Race leader</div>
                <div class="race-value">${race.leader}</div>
              </div>

              <div>
                <div class="race-label">Runners</div>
                ${runnersHTML}
                ${signupHTML}
              </div>
            </div>
          `;

          cards.appendChild(card);

        });
        
        // Show table, hide loading
        loadingEl.style.display = 'none';
        errorEl.style.display = 'none';
        tableEl.style.display = ''; // let CSS decide
        document.getElementById('cardsContainer').style.display = ''; // let CSS decide
        
      } catch (error) {
        console.error('Error loading races:', error);
        loadingEl.style.display = 'none';
        errorEl.style.display = '';
        tableEl.style.display = 'none';
        document.getElementById('cardsContainer').style.display = 'none';
      }
    }
    
    // Compute a stable raceId that matches the API logic
    function makeRaceId(race) {
      if (race && race.id) return String(race.id);
      const name = String(race?.name || '')
        .toLowerCase()
        .replace(/[^a-z0-9]+/g, '-')
        .replace(/(^-|-$)/g, '');
      const date = String(race?.date || '').trim();
      return `${name}-${date}`;
    }

    // Render signup UI (unique per race)
    function renderSignup(raceId) {
      const safeId = String(raceId).replace(/[^a-zA-Z0-9_-]/g, '_');
      return `
        <div class="signup" data-race-id="${raceId}">
          <input type="text" id="runner_${safeId}" placeholder="Add your name" autocomplete="name" maxlength="40" />
          <button class="btn-inline" type="button" onclick="addRunner('${raceId}', '${safeId}')">Add</button>
          <div class="msg" id="msg_${safeId}" aria-live="polite"></div>
        </div>
      `;
    }

    // POST to Vercel API and refresh UI
    async function addRunner(raceId, safeId) {
      const input = document.getElementById(`runner_${safeId}`);
      const msg = document.getElementById(`msg_${safeId}`);
      const btn = input?.parentElement?.querySelector('button.btn-inline');

      const runnerName = (input?.value || '').trim().replace(/\s+/g, ' ');
      if (!runnerName) {
        msg.textContent = 'Please enter your name.';
        return;
      }

      msg.textContent = 'Adding‚Ä¶';
      if (btn) btn.disabled = true;

      try {
        const resp = await fetch('https://running-club-api.vercel.app/api/add-runner', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ raceId, runnerName })
        });

        const payload = await resp.json().catch(() => ({}));

        if (!resp.ok) {
          const errText = payload?.error ? `${payload.error}` : 'Unable to add runner.';
          msg.textContent = payload?.detail ? `${errText}` : errText;
          return;
        }

        msg.textContent = payload.added ? 'Added! Refreshing‚Ä¶' : 'You are already on the list. Refreshing‚Ä¶';
        if (input) input.value = '';

        // Reload races (cache-busted) so the list updates everywhere
        await loadRaces();
      } catch (e) {
        msg.textContent = 'Network error. Please try again.';
      } finally {
        if (btn) btn.disabled = false;
      }
    }

    // Format runners list
    function formatRunners(runners) {
      if (!runners || runners.length === 0) {
        return '<span style="color: var(--text-muted, #888); font-style: italic;">No signups yet</span>';
      }
      
      const count = runners.length;
      const countBadge = `<span class="runner-count">${count}</span> runner${count !== 1 ? 's' : ''}`;
      
      const runnerTags = runners.map(name => 
        `<span class="runner-tag">${name}</span>`
      ).join('');
      
      return `<div style="margin-bottom: 6px;">${countBadge}</div><div class="runners-list">${runnerTags}</div>`;
    }
    
    // Format date to readable format
    function formatDate(dateString) {
      const date = new Date(dateString);
      const options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
      return date.toLocaleDateString('en-US', options);
    }
    
    // Load races when page loads
    document.addEventListener('DOMContentLoaded', loadRaces);
  </script>
</body>
</html>